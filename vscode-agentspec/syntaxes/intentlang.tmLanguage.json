{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "IntentLang",
  "scopeName": "source.intentlang",
  "patterns": [
    { "include": "#comments" },
    { "include": "#strings" },
    { "include": "#numbers" },
    { "include": "#template-variables" },
    { "include": "#control-flow" },
    { "include": "#keywords" },
    { "include": "#block-types" },
    { "include": "#attributes" },
    { "include": "#operators" },
    { "include": "#constants" },
    { "include": "#functions" },
    { "include": "#types" }
  ],
  "repository": {
    "comments": {
      "patterns": [
        {
          "name": "comment.line.double-slash.intentlang",
          "match": "//.*$"
        },
        {
          "name": "comment.line.hash.intentlang",
          "match": "#.*$"
        }
      ]
    },
    "strings": {
      "patterns": [
        {
          "name": "string.quoted.triple.intentlang",
          "begin": "\"\"\"",
          "end": "\"\"\"",
          "patterns": [
            { "include": "#template-variables" }
          ]
        },
        {
          "name": "string.quoted.double.intentlang",
          "begin": "\"",
          "end": "\"",
          "patterns": [
            {
              "name": "constant.character.escape.intentlang",
              "match": "\\\\."
            },
            { "include": "#template-variables" }
          ]
        }
      ]
    },
    "template-variables": {
      "patterns": [
        {
          "name": "variable.other.template.intentlang",
          "match": "\\{\\{\\s*[a-zA-Z_][a-zA-Z0-9_.]*\\s*\\}\\}"
        }
      ]
    },
    "numbers": {
      "patterns": [
        {
          "name": "constant.numeric.float.intentlang",
          "match": "\\b[0-9]+\\.[0-9]+\\b"
        },
        {
          "name": "constant.numeric.integer.intentlang",
          "match": "\\b[0-9]+\\b"
        }
      ]
    },
    "control-flow": {
      "patterns": [
        {
          "name": "keyword.control.conditional.intentlang",
          "match": "\\b(if|else\\s+if|else)\\b"
        },
        {
          "name": "keyword.control.loop.intentlang",
          "match": "\\b(for)\\s+(each)\\b"
        },
        {
          "name": "keyword.control.action.intentlang",
          "match": "\\b(use)\\s+(skill)\\b"
        },
        {
          "name": "keyword.control.action.intentlang",
          "match": "\\b(delegate)\\s+(to)\\b"
        },
        {
          "name": "keyword.control.action.intentlang",
          "match": "\\b(respond)\\b"
        },
        {
          "name": "keyword.control.event.intentlang",
          "match": "\\b(on)\\s+(input)\\b"
        }
      ]
    },
    "keywords": {
      "patterns": [
        {
          "name": "keyword.control.intentlang",
          "match": "\\b(uses|from|when|to|depends_on|parallel|on_error|fallback|as|in|with)\\b"
        },
        {
          "name": "keyword.other.import.intentlang",
          "match": "\\b(import)\\b"
        },
        {
          "name": "keyword.other.package.intentlang",
          "match": "\\b(package)\\b"
        },
        {
          "name": "keyword.other.version.intentlang",
          "match": "\\b(version|lang)\\b"
        }
      ]
    },
    "block-types": {
      "patterns": [
        {
          "name": "storage.type.agent.intentlang",
          "match": "\\b(agent)(?=\\s+\")"
        },
        {
          "name": "storage.type.prompt.intentlang",
          "match": "\\b(prompt)(?=\\s+\")"
        },
        {
          "name": "storage.type.skill.intentlang",
          "match": "\\b(skill)(?=\\s+\")"
        },
        {
          "name": "storage.type.intentlang",
          "match": "\\b(deploy|target|pipeline|step|delegate|type|tool|memory|health|autoscale|resources|variables|environment|secret)\\b"
        },
        {
          "name": "storage.type.config.intentlang",
          "match": "\\b(config|validate|eval)\\s*\\{"
        },
        {
          "name": "storage.type.rule.intentlang",
          "match": "\\b(rule)\\s+"
        },
        {
          "name": "storage.type.case.intentlang",
          "match": "\\b(case)\\s+"
        }
      ]
    },
    "attributes": {
      "patterns": [
        {
          "name": "variable.other.property.intentlang",
          "match": "\\b(model|strategy|max_turns|timeout|token_budget|temperature|stream|max_retries|content|description|transport|command|args|method|url|port|replicas|cpu|min_replicas|max_replicas|target_cpu|max_messages|interval|path|name|version|language|code|body_template)\\b"
        },
        {
          "name": "variable.other.property.schema.intentlang",
          "match": "\\b(input|output|required|default|enum|list|condition)\\b"
        },
        {
          "name": "variable.other.property.eval.intentlang",
          "match": "\\b(scoring|threshold|tags|expect)\\b"
        },
        {
          "name": "variable.other.property.validation.intentlang",
          "match": "\\b(error|warning)\\b"
        },
        {
          "name": "variable.other.property.config.intentlang",
          "match": "\\b(secret)\\b(?!\\s+\")"
        }
      ]
    },
    "operators": {
      "patterns": [
        {
          "name": "keyword.operator.comparison.intentlang",
          "match": "(==|!=|>=|<=|>|<)"
        },
        {
          "name": "keyword.operator.logical.intentlang",
          "match": "\\b(and|or|not)\\b"
        },
        {
          "name": "keyword.operator.assignment.intentlang",
          "match": "="
        }
      ]
    },
    "constants": {
      "patterns": [
        {
          "name": "constant.language.boolean.intentlang",
          "match": "\\b(true|false)\\b"
        },
        {
          "name": "constant.language.null.intentlang",
          "match": "\\b(null|nil)\\b"
        }
      ]
    },
    "types": {
      "patterns": [
        {
          "name": "support.type.intentlang",
          "match": "\\b(string|int|float|bool)\\b"
        }
      ]
    },
    "functions": {
      "patterns": [
        {
          "name": "support.function.builtin.intentlang",
          "match": "\\b(env|store|ref|contains|lower|upper|len|trim)\\s*\\("
        },
        {
          "name": "entity.name.type.strategy.intentlang",
          "match": "\\b(react|plan_execute|reflexion|router|map_reduce)\\b"
        },
        {
          "name": "entity.name.type.tool.intentlang",
          "match": "(?<=tool\\s)(mcp|http|command|inline)\\b"
        },
        {
          "name": "entity.name.type.target.intentlang",
          "match": "(?<=target\\s\")(process|docker|kubernetes|compose)\\b"
        },
        {
          "name": "entity.name.type.memory.intentlang",
          "match": "\\b(sliding_window|summary)\\b"
        },
        {
          "name": "entity.name.type.scoring.intentlang",
          "match": "(?<=scoring\\s)(contains|semantic|exact|regex)\\b"
        }
      ]
    }
  }
}
